PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "migrations" ("id" integer primary key autoincrement not null, "migration" varchar not null, "batch" integer not null);
INSERT INTO migrations VALUES(1,'0001_01_01_000000_create_users_table',1);
INSERT INTO migrations VALUES(2,'0001_01_01_000001_create_cache_table',1);
INSERT INTO migrations VALUES(3,'0001_01_01_000002_create_jobs_table',1);
INSERT INTO migrations VALUES(4,'2024_12_08_000001_add_fields_to_users_table',1);
INSERT INTO migrations VALUES(5,'2024_12_08_000002_create_loans_table',1);
INSERT INTO migrations VALUES(6,'2024_12_08_000003_create_repayments_table',1);
INSERT INTO migrations VALUES(7,'2024_12_08_000004_create_kyc_documents_table',1);
INSERT INTO migrations VALUES(8,'2024_12_08_000005_create_settings_table',1);
INSERT INTO migrations VALUES(9,'2024_12_08_000006_create_roles_and_permissions_tables',1);
INSERT INTO migrations VALUES(10,'2024_12_08_000007_add_kyc_status_to_users_table',1);
INSERT INTO migrations VALUES(11,'2024_12_08_000008_create_payments_table',1);
INSERT INTO migrations VALUES(12,'2025_12_08_024828_create_personal_access_tokens_table',1);
CREATE TABLE IF NOT EXISTS "users" ("id" integer primary key autoincrement not null, "name" varchar not null, "email" varchar not null, "email_verified_at" datetime, "password" varchar not null, "remember_token" varchar, "created_at" datetime, "updated_at" datetime, "phone" varchar, "role" varchar check ("role" in ('customer', 'admin')) not null default 'customer', "status" varchar check ("status" in ('pending', 'active', 'suspended')) not null default 'pending', "address" text, "city" varchar, "state" varchar, "kyc_status" varchar check ("kyc_status" in ('pending', 'verified', 'rejected')) not null default 'pending');
INSERT INTO users VALUES(1,'Super Admin','admin@digitmonie.com',NULL,'$2y$12$UxaeZXO8.94.0QYJQrF63O.VlAPZgl12eKfNHnyFJXF3C8W/60oPe',NULL,'2025-12-14 14:05:05','2025-12-14 14:05:05','+234 800 000 0000','admin','active',NULL,NULL,NULL,'pending');
CREATE TABLE IF NOT EXISTS "password_reset_tokens" ("email" varchar not null, "token" varchar not null, "created_at" datetime, primary key ("email"));
CREATE TABLE IF NOT EXISTS "sessions" ("id" varchar not null, "user_id" integer, "ip_address" varchar, "user_agent" text, "payload" text not null, "last_activity" integer not null, primary key ("id"));
CREATE TABLE IF NOT EXISTS "cache" ("key" varchar not null, "value" text not null, "expiration" integer not null, primary key ("key"));
CREATE TABLE IF NOT EXISTS "cache_locks" ("key" varchar not null, "owner" varchar not null, "expiration" integer not null, primary key ("key"));
CREATE TABLE IF NOT EXISTS "jobs" ("id" integer primary key autoincrement not null, "queue" varchar not null, "payload" text not null, "attempts" integer not null, "reserved_at" integer, "available_at" integer not null, "created_at" integer not null);
CREATE TABLE IF NOT EXISTS "job_batches" ("id" varchar not null, "name" varchar not null, "total_jobs" integer not null, "pending_jobs" integer not null, "failed_jobs" integer not null, "failed_job_ids" text not null, "options" text, "cancelled_at" integer, "created_at" integer not null, "finished_at" integer, primary key ("id"));
CREATE TABLE IF NOT EXISTS "failed_jobs" ("id" integer primary key autoincrement not null, "uuid" varchar not null, "connection" text not null, "queue" text not null, "payload" text not null, "exception" text not null, "failed_at" datetime not null default CURRENT_TIMESTAMP);
CREATE TABLE IF NOT EXISTS "loans" ("id" integer primary key autoincrement not null, "user_id" integer not null, "amount" numeric not null, "interest_rate" numeric not null default '15', "tenure_months" integer not null, "purpose" varchar not null, "purpose_details" text, "employment_type" varchar check ("employment_type" in ('employed', 'self_employed', 'business', 'contract', 'retired')), "monthly_income" numeric, "bank_name" varchar, "account_number" varchar, "status" varchar check ("status" in ('pending', 'under_review', 'approved', 'rejected', 'disbursed', 'active', 'completed', 'defaulted')) not null default 'pending', "approved_by" integer, "approved_at" datetime, "disbursed_at" datetime, "rejection_reason" text, "created_at" datetime, "updated_at" datetime, foreign key("user_id") references "users"("id") on delete cascade, foreign key("approved_by") references "users"("id") on delete set null);
CREATE TABLE IF NOT EXISTS "repayments" ("id" integer primary key autoincrement not null, "loan_id" integer not null, "amount" numeric not null, "principal" numeric not null, "interest" numeric not null, "due_date" date not null, "paid_at" datetime, "status" varchar check ("status" in ('pending', 'paid', 'overdue', 'partial')) not null default 'pending', "payment_reference" varchar, "created_at" datetime, "updated_at" datetime, foreign key("loan_id") references "loans"("id") on delete cascade);
CREATE TABLE IF NOT EXISTS "kyc_documents" ("id" integer primary key autoincrement not null, "user_id" integer not null, "document_type" varchar check ("document_type" in ('id_card', 'passport', 'utility_bill', 'bank_statement')) not null, "file_name" varchar not null, "file_path" varchar not null, "mime_type" varchar, "file_size" integer, "status" varchar check ("status" in ('pending', 'approved', 'rejected')) not null default 'pending', "reviewed_by" integer, "reviewed_at" datetime, "rejection_reason" text, "created_at" datetime, "updated_at" datetime, foreign key("user_id") references "users"("id") on delete cascade, foreign key("reviewed_by") references "users"("id") on delete set null);
CREATE TABLE IF NOT EXISTS "settings" ("id" integer primary key autoincrement not null, "key" varchar not null, "value" text not null, "created_at" datetime, "updated_at" datetime);
INSERT INTO settings VALUES(1,'currencies','[{"code":"NGN","symbol":"\u20a6","name":"Nigerian Naira","active":true},{"code":"USD","symbol":"$","name":"US Dollar","active":false},{"code":"GBP","symbol":"\u00a3","name":"British Pound","active":false}]','2025-12-14 14:05:04','2025-12-14 14:05:04');
INSERT INTO settings VALUES(2,'loan_settings','{"min_amount":50000,"max_amount":5000000,"min_tenure":3,"max_tenure":36,"default_interest_rate":15}','2025-12-14 14:05:04','2025-12-14 14:05:04');
INSERT INTO settings VALUES(3,'notification_settings','{"reminder_days_before":3,"overdue_notification":true,"approval_notification":true,"disbursement_notification":true}','2025-12-14 14:05:04','2025-12-14 14:05:04');
INSERT INTO settings VALUES(4,'payment_gateways','{"active_gateway":"paystack","paystack":{"public_key":"","secret_key":"","enabled":true},"flutterwave":{"public_key":"","secret_key":"","enabled":false}}','2025-12-14 14:05:05','2025-12-14 14:05:05');
CREATE TABLE IF NOT EXISTS "roles" ("id" integer primary key autoincrement not null, "name" varchar not null, "display_name" varchar not null, "description" text, "created_at" datetime, "updated_at" datetime);
INSERT INTO roles VALUES(1,'super_admin','Super Admin','Full system access with all permissions','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO roles VALUES(2,'loan_manager','Loan Manager','Can review and approve/reject loan applications','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO roles VALUES(3,'kyc_officer','KYC Officer','Can review and verify KYC documents','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO roles VALUES(4,'support','Support Staff','Read-only access to view users and applications','2025-12-14 14:05:05','2025-12-14 14:05:05');
CREATE TABLE IF NOT EXISTS "permissions" ("id" integer primary key autoincrement not null, "name" varchar not null, "display_name" varchar not null, "description" text, "created_at" datetime, "updated_at" datetime);
INSERT INTO permissions VALUES(1,'manage_users','Manage Users','Create, update, suspend users','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO permissions VALUES(2,'assign_roles','Assign Roles','Assign roles to staff members','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO permissions VALUES(3,'manage_loans','Manage Loans','Approve or reject loan applications','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO permissions VALUES(4,'manage_kyc','Manage KYC','Verify or reject KYC documents','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO permissions VALUES(5,'view_reports','View Reports','Access dashboard and reports','2025-12-14 14:05:05','2025-12-14 14:05:05');
INSERT INTO permissions VALUES(6,'manage_settings','Manage Settings','Update system settings','2025-12-14 14:05:05','2025-12-14 14:05:05');
CREATE TABLE IF NOT EXISTS "role_user" ("id" integer primary key autoincrement not null, "role_id" integer not null, "user_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("role_id") references "roles"("id") on delete cascade, foreign key("user_id") references "users"("id") on delete cascade);
INSERT INTO role_user VALUES(1,1,1,NULL,NULL);
CREATE TABLE IF NOT EXISTS "permission_role" ("id" integer primary key autoincrement not null, "permission_id" integer not null, "role_id" integer not null, "created_at" datetime, "updated_at" datetime, foreign key("permission_id") references "permissions"("id") on delete cascade, foreign key("role_id") references "roles"("id") on delete cascade);
INSERT INTO permission_role VALUES(1,2,1,NULL,NULL);
INSERT INTO permission_role VALUES(2,4,1,NULL,NULL);
INSERT INTO permission_role VALUES(3,3,1,NULL,NULL);
INSERT INTO permission_role VALUES(4,6,1,NULL,NULL);
INSERT INTO permission_role VALUES(5,1,1,NULL,NULL);
INSERT INTO permission_role VALUES(6,5,1,NULL,NULL);
INSERT INTO permission_role VALUES(7,3,2,NULL,NULL);
INSERT INTO permission_role VALUES(8,5,2,NULL,NULL);
INSERT INTO permission_role VALUES(9,4,3,NULL,NULL);
INSERT INTO permission_role VALUES(10,5,3,NULL,NULL);
INSERT INTO permission_role VALUES(11,5,4,NULL,NULL);
CREATE TABLE IF NOT EXISTS "payments" ("id" integer primary key autoincrement not null, "user_id" integer not null, "loan_id" integer not null, "repayment_id" integer, "amount" numeric not null, "gateway" varchar not null, "reference" varchar not null, "gateway_reference" varchar, "status" varchar check ("status" in ('pending', 'success', 'failed')) not null default 'pending', "gateway_response" text, "paid_at" datetime, "created_at" datetime, "updated_at" datetime, foreign key("user_id") references "users"("id") on delete cascade, foreign key("loan_id") references "loans"("id") on delete cascade, foreign key("repayment_id") references "repayments"("id") on delete set null);
CREATE TABLE IF NOT EXISTS "personal_access_tokens" ("id" integer primary key autoincrement not null, "tokenable_type" varchar not null, "tokenable_id" integer not null, "name" text not null, "token" varchar not null, "abilities" text, "last_used_at" datetime, "expires_at" datetime, "created_at" datetime, "updated_at" datetime);
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('migrations',12);
INSERT INTO sqlite_sequence VALUES('settings',4);
INSERT INTO sqlite_sequence VALUES('permissions',6);
INSERT INTO sqlite_sequence VALUES('roles',4);
INSERT INTO sqlite_sequence VALUES('permission_role',11);
INSERT INTO sqlite_sequence VALUES('users',1);
INSERT INTO sqlite_sequence VALUES('role_user',1);
CREATE UNIQUE INDEX "users_email_unique" on "users" ("email");
CREATE INDEX "sessions_user_id_index" on "sessions" ("user_id");
CREATE INDEX "sessions_last_activity_index" on "sessions" ("last_activity");
CREATE INDEX "jobs_queue_index" on "jobs" ("queue");
CREATE UNIQUE INDEX "failed_jobs_uuid_unique" on "failed_jobs" ("uuid");
CREATE UNIQUE INDEX "settings_key_unique" on "settings" ("key");
CREATE UNIQUE INDEX "roles_name_unique" on "roles" ("name");
CREATE UNIQUE INDEX "permissions_name_unique" on "permissions" ("name");
CREATE UNIQUE INDEX "role_user_role_id_user_id_unique" on "role_user" ("role_id", "user_id");
CREATE UNIQUE INDEX "permission_role_permission_id_role_id_unique" on "permission_role" ("permission_id", "role_id");
CREATE UNIQUE INDEX "payments_reference_unique" on "payments" ("reference");
CREATE INDEX "personal_access_tokens_tokenable_type_tokenable_id_index" on "personal_access_tokens" ("tokenable_type", "tokenable_id");
CREATE UNIQUE INDEX "personal_access_tokens_token_unique" on "personal_access_tokens" ("token");
CREATE INDEX "personal_access_tokens_expires_at_index" on "personal_access_tokens" ("expires_at");
COMMIT;
